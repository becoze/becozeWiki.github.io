Êú¨Ê¨°Áõ¥Êí≠ÂÜÖÂÆπÔºö

1. ‰∏äÊ¨°Áõ¥Êí≠ÈóÆÈ¢òÊÄªÁªì üìå
2. Áî®Êà∑Êï∞ÊçÆÂ∫ìË°®ËÆæËÆ° üìå
3. ÂÆåÊàêÁôªÂΩïÊ≥®ÂÜåÁöÑÂâçÂêéÁ´ØÂºÄÂèë üìå
4. ÂÆåÊàêÁî®Êà∑ÁÆ°ÁêÜÂêéÂè∞ÁöÑÂâçÂêéÁ´ØÂºÄÂèë

# ËÆ°Âàí

1. ÂàùÂßãÂåñÈ°πÁõÆ‚úî

   1. ÂâçÁ´ØÂàùÂßãÂåñ   ‚úî

      1. ÂàùÂßãÂåñÈ°πÁõÆ 
      2. ÂºïÂÖ•‰∏Ä‰∫õÁªÑ‰ª∂‰πãÁ±ªÁöÑ 
      3. Ê°ÜÊû∂‰ªãÁªç / Áò¶Ë∫´ 


   2. ÂêéÁ´ØÂàùÂßãÂåñ  ‚úî

      1. ÂáÜÂ§áÁéØÂ¢ÉÔºàMySQL ‰πãÁ±ªÁöÑÔºâÈ™åËØÅ MySQL ÊòØÂê¶ÂÆâË£ÖÊàêÂäü - ËøûÊé•‰∏Ä‰∏ã 

      2. ÂàùÂßãÂåñÂêéÁ´ØÈ°πÁõÆÔºåÂºïÂÖ•Ê°ÜÊû∂ÔºàÊï¥ÂêàÊ°ÜÊû∂Ôºâ

2. Êï∞ÊçÆÂ∫ìËÆæËÆ° üìå
3. ÁôªÂΩï/Ê≥®ÂÜå üìå
   1. ÂêéÁ´Ø üìå
      1. ËßÑÊï¥È°πÁõÆÁõÆÂΩï üìå
      2. ÂÆûÁé∞Âü∫Êú¨Êï∞ÊçÆÂ∫ìÊìç‰ΩúÔºàÊìç‰ΩúuserË°®Ôºâüìå
         1. Ê®°ÂûãuserÂØπË±° => ÂíåÊï∞ÊçÆÂ∫ìÁöÑÂ≠óÊÆµÂÖ≥ËÅîÔºåËá™Âä®ÁîüÊàê üìå
         2. ÊµãËØï üìå
      3. ÂÜôÊ≥®ÂÜåÈÄªËæëÔºå‰ª£Á†ÅÂíåÊµãËØï üìå
      4. ÂÜôÁôªÂΩïÈÄªËæëÔºå‰ª£Á†ÅÂíåÊµãËØïÔºànot completeÔºâ
   2. ÂâçÁ´ØÔºànot completeÔºâ
      1. Âà†Èô§Â§ö‰Ωô‰ª£Á†Å
4. Áî®Êà∑ÁÆ°ÁêÜÔºà‰ªÖÁÆ°ÁêÜÂëòÂèØËßÅÔºâ 

   1. ÂâçÁ´Ø
   2. ÂêéÁ´Ø

# Êï∞ÊçÆÂ∫ìËÆæËÆ°

## ‰ªÄ‰πàÊòØÊï∞ÊçÆÂ∫ì

QÔºö‰ªÄ‰πàÊòØÊï∞ÊçÆÂ∫ìÔºü

AÔºöÂ≠òÊï∞ÊçÆÁöÑ



QÔºöÊï∞ÊçÆÂ∫ìÈáåÊúâ‰ªÄ‰πàÔºü

AÔºöÊï∞ÊçÆË°®ÔºàÁêÜËß£‰∏∫ excel Ë°®Ê†ºÔºâ



QÔºö‰∏∫‰ªÄ‰πàÁî® java Êìç‰ΩúÊï∞ÊçÆÂ∫ì

AÔºö‰ª£Êõø‰∫∫Â∑•ÔºåÈÄöÂ∏∏ÊòØPythonÔºåjava ‰πüÂèØ‰ª•



QÔºö‰ªÄ‰πàÊòØËÆæËÆ°Êï∞ÊçÆÂ∫ìË°®Ôºü

AÔºöÊ†πÊçÆÈúÄÊ±ÇÊÄùËÄÉÊúâÂì™‰∫õË°®ÔºàÊ®°ÂûãÔºâÔºüË°®‰∏≠ÊúâÂì™‰∫õÂ≠óÊÆµÔºàidÔºånameÔºâÔºüÂ≠óÊÆµÁöÑÁ±ªÂûãÔºüÊï∞ÊçÆÂ∫ìÂ≠óÊÆµÊ∑ªÂä†Á¥¢ÂºïÔºüÂíåË°®‰∏éË°®‰πãÈó¥ÁöÑÂÖ≥ËÅî„ÄÇ

> Á¥¢ÂºïÔºöÁ±ª‰ºº‰∫é‰∏ÄÊú¨‰π¶ÁõÆÂΩïÁöÑÈ°µÁ†ÅÔºåÁ¥¢ÂºïÈÄöÂ∏∏ÁªôÂà∞ÔºöÁªèÂ∏∏Áî®Âà∞ÁöÑÊü•ËØ¢Â≠óÊÆµÊàñÊù°‰ª∂„ÄÇÂ¶ÇÔºöusername Áî®Êà∑Âêç„ÄÇÔºà‰ΩÜÂ¶ÇÔºögender ÊÄßÂà´ÔºåËøôÁßçÂå∫ÂàÜÂ∫¶‰∏çÂ§ßÁöÑ‰∏çÂª∫ËÆÆÂä†Á¥¢ÂºïÔºâ
>
> Ë°®‰∏éË°®‰πãÈó¥ÁöÑÂÖ≥ËÅîÔºöÂ§öÂº†Ë°®‰πãÈó¥ÁöÑÂÖ≥ËÅîÔºàForeign KeyÔºâ

## Êï∞ÊçÆÂ∫ìË°®ËÆæËÆ°

Database -> nautilus -> tablve -> Right Click user table -> Navigation -> Jump to Query Console -> New console, default console or exist console.

Drop the MyBaties-plus demo table using `DROP TABLE user;` and execute it. 

Database -> Rick Click nautilus -> New -> Table (Old UI)

| Field / Name |                                        | States                     | Type                    |
| :----------- | -------------------------------------- | -------------------------- | ----------------------- |
| id           | ‰∏ªÈîÆ                                   | Primary key, Auto inc      | bigint                  |
| username     | ÊòµÁß∞                                   |                            | varchar(256)            |
| userAccount  | ÁôªÂΩïË¥¶Âè∑                               |                            | varchar(256)            |
| avatarUrl    | Â§¥ÂÉè                                   |                            | varchar(1024)           |
| gender       | ÊÄßÂà´                                   |                            | tinyint                 |
| userPassword | ÂØÜÁ†Å                                   | Not Null                   | varchar(512)            |
| phone        | ÁîµËØù                                   |                            | varchar(128)            |
| email        | ÈÇÆÁÆ±                                   |                            | varchar(512)            |
| userStatus   | Áî®Êà∑Áä∂ÊÄÅ                               | Not Null, Default: 0       | intÔºàÊ≠£Â∏∏ÔºåÂ∞ÅÂè∑ÔºåËøáÊúüÔºâ |
| createTime   | ÂàõÂª∫Êó∂Èó¥ÔºàÊï∞ÊçÆÊèíÂÖ•Êó∂Èó¥Ôºâ               | Default: CURRENT_TIMESTAMP | datetime                |
| updateTime   | Êõ¥Êñ∞Êó∂Èó¥ÔºàÊï∞ÊçÆÊõ¥Êñ∞Êó∂Èó¥Ôºâ               | Default: CURRENT_TIMESTAMP | datetime                |
| isDelete     | ÊòØÂê¶Âà†Èô§ÔºàÈÄªËæëÂà†Èô§ 0 1Ôºå‰∏çÊòØÁúüÁöÑÂà†Èô§Ôºâ | Not Null, Default: 0       | tinyint                 |

See SQL source code: Right Click table `user` -> Navigation -> go to DDL

Copy all code from DDEL to database console.

turn 

```mysql
updateTime   datetime default CURRENT_TIMESTAMP null,
```

into 

```
updateTime   datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP,
```

Finial code:

```mysql
create table user
(
    id           bigint auto_increment
        primary key,
    username     varchar(256)                       null,
    userAccount  varchar(256)                       null,
    avatarUrl    varchar(1024)                      null,
    gender       tinyint                            null,
    userPassword varchar(512)                       not null,
    phone        varchar(128)                       null,
    email        varchar(512)                       null,
    userStatus   int      default 0                 not null comment '0 - valid user',
    createTime   datetime default CURRENT_TIMESTAMP null,
    updateTime   datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP,
    isDelete     tinyint  default 0                 not null comment 'logical delete, 0 - not deleted, 1 - deleted'
)
    comment 'User Table';
```

  Error:

do not use `CURRENT_TIME` on `createTime` and `updateTime`.



# ÂêéÁ´Ø - Ê≥®ÂÜåÂäüËÉΩ

## ËßÑÊï¥È°πÁõÆÁõÆÂΩï

src -> main -> java -> com.becoze.usercenter ‰∏ãÈù¢ÂàõÂª∫‰ª•‰∏ãÂåÖ

* `controller ` package
* `service ` package 
* `util` package 

src -> main -> resource ‰∏ãÈù¢Âà†Èô§‰ª•‰∏ãÊñá‰ª∂

* static
* templates 

| ÁõÆÂΩï/Êñá‰ª∂             | ‰ΩúÁî®                                                         |
| --------------------- | ------------------------------------------------------------ |
| controller            | ËØ∑Ê±ÇÂ±ÇÊàñËÄÖÂè´ÊéßÂà∂Â±Ç„ÄÇÁõÆÂΩïÈáåÁöÑÊâÄÊúâÁöÑÊñá‰ª∂‰∏ìÈó®Áî®Êù•Êé•Êî∂ËØ∑Ê±ÇÔºåÂØπ‰∏çÂÅö‰ªª‰ΩïÁöÑ‰∏öÂä°Â§ÑÁêÜÔºåÂè™ÂéªÊé•Êî∂ËØ∑Ê±Ç„ÄÇ |
| service               | ‰∏ìÈó®Áî®Êù•ÁºñÂÜô‰∏öÂä°ÈÄªËæëÔºåÊØîÂ¶ÇÔºöÁôªÂΩïÔºåÊ≥®ÂÜå„ÄÇ                     |
| mapper                | Êï∞ÊçÆËÆøÈóÆÂ±ÇÔºå‰∏ìÈó®Áî®‰∫é‰ªéÊï∞ÊçÆÂ∫ì‰∏≠ÂéªÊü•ËØ¢Êï∞ÊçÆÔºåÂéªÂèñÊï∞ÊçÆÔºåÂ¶ÇÂ¢ûÂà†ÊîπÊü• |
| model                 | ÂÆö‰πâ‰∫ÜÂíåÊï∞ÊçÆÂ∫ìÁõ∏ÂØπÂ∫îÁöÑÊ®°ÂûãÔºåÊàñËÄÖÂí±‰ª¨Áî®Âà∞ÁöÑ‰∏Ä‰∫õÂ∞ÅË£ÖÁ±ª„ÄÇÂ¶ÇÔºö‰πãÂâçdemo model.user Êñá‰ª∂ÈáåÂØπÂ∫î‰∫ÜdemoÊï∞ÊçÆÂ∫ìÁöÑÂàóÂêç |
| utils                 | Â≠òÊîæ‰∏Ä‰∫õÂ∑•ÂÖ∑Á±ª„ÄÇÊØîÂ¶ÇÂä†ÂØÜÔºåÊ†ºÂºèËΩ¨Êç¢ÔºåÊó•ÊúüËΩ¨Êç¢Á≠â„ÄÇÂíå‰∏öÂä°ÂÖ≥Á≥ª‰∏çÂ§™Â§ßÁöÑ„ÄÇ‰∏∫‰∫ÜËäÇÁúÅÊàë‰ª¨ÁöÑÊìç‰Ωú„ÄÇ |
| resource -> static    | ‰∏ÄËà¨ÂÜôÂâçÂêéÁëû‰∏çÂàÜÁ¶ªÁöÑÈ°πÁõÆÔºåÂú®staticÊîæ‰∏Ä‰∫õÈùôÊÄÅÊñá‰ª∂             |
| resource -> templates | ‰∏ÄËà¨ÂÜôÂâçÂêéÁëû‰∏çÂàÜÁ¶ªÁöÑÈ°πÁõÆÔºåÊîæÈ°µÈù¢Ê®°ÊùøÊñá‰ª∂                     |



## ÂàÜÊûêÊ≥®ÂÜåÈÄªËæë



## ÂÆûÁé∞Âü∫Êú¨Êï∞ÊçÆÂ∫ìÊìç‰Ωú(MyBatisX)

### Âà†Èô§demoÊï∞ÊçÆ

`src.main.java.com.becoze.usercenter` -> model ‰∏ãÂà†Êéâ‰πãÂâçÁöÑ `User` demo

`src.main.java.com.becoze.usercenter` -> mapper ‰∏ãÂà†Êéâ‰πãÂâçÁöÑ `UserMapper` demo

`src.test.java.com.becoze.usercenter` ‰∏ãÂà†Êéâ‰πãÂâçÁöÑ `SampleTest` demo

### MyBatisX ÂÆâË£ÖÔºå‰ΩøÁî®ÂíåÊµãËØï 

> MyBatisX Êèí‰ª∂ÔºåËá™Âä®Ê†πÊçÆÊï∞ÊçÆÂ∫ìÁîüÊàê domain ÂÆû‰ΩìÂØπË±°„ÄÅmapperÔºàÊìç‰ΩúÊï∞ÊçÆÂ∫ìÁöÑÂØπË±°Ôºâ„ÄÅmapper.xmlÔºàÂÆö‰πâ‰∫Ü mapperÂØπË±°ÂíåÊï∞ÊçÆÂ∫ìÁöÑÂÖ≥ËÅîÔºåÂèØ‰ª•Âú®ÈáåÈù¢Ëá™Â∑±ÂÜô SQLÔºâ„ÄÅserviceÔºàÂåÖÂê´Â∏∏Áî®ÁöÑÂ¢ûÂà†ÊîπÊü•Ôºâ„ÄÅserviceImplÔºàÂÖ∑‰ΩìÂÆûÁé∞ serviceÔºâ

#### ÂÆâË£ÖMyBatisX Êèí‰ª∂

File -> Setting -> Plugins -> ÊêúÁ¥¢Âπ∂ÂÆâË£Ö MyBatisX Êèí‰ª∂„ÄÇ

#### ‰ΩøÁî®MyBatisX 

Database -> nautilus -> tables -> Right Click `user` table -> MybatisX-Generator 

![image-20230504203653382](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230504203653382.png)

-> Next

![image-20230504204559348](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230504204559348.png)

-> Finish



Code generated at: src -> main -> java -> generator 

| File                         | Description                                                  |
| ---------------------------- | ------------------------------------------------------------ |
| domain.user                  | userÂÆû‰ΩìÁ±ªÂØπË±°„ÄÇ                                             |
| mapper.UserMapper            | Áî®Êù•Êìç‰ΩúÊï∞ÊçÆÂ∫ìÁöÑ‰∏Ä‰∏™ÂØπË±°„ÄÇÁªßÊâø‰∫ÜMyBatiesÂÜôÂ•ΩÁöÑCRUDÊñπÊ≥ï„ÄÇ     |
| service.UserService          | ‰∏öÂä°Êé•Âè£„ÄÇÊé•Âè£ÈáåÈù¢Âè™ÂÆö‰πâÊñπÊ≥ïÔºå‰ΩÜ‰∏çÂéªÂÖ∑‰ΩìÂÆûÁé∞„ÄÇÂè™ÁÆ°Êé•Êî∂ÂèÇÊï∞ÂíåËøîÂõûÂØπÂ∫îÁöÑÂÄº„ÄÇ |
| service.impl.UserserciceImpl | ‰∏öÂä°ÂÆûÁé∞Á±ª„ÄÇË∞ÉÁî® `service.UserService` ÈáåÁöÑÊñπÊ≥ïÂÆûÁé∞ÂÖ∑‰Ωì‰∏öÂä°ÈÄªËæëÔºåÂ¶ÇÔºöÂÖ∑‰ΩìÊÄé‰πàÁôªÈôÜÔºåÊÄé‰πàÊ≥®ÂÜå |



ÊãñÂä®‰∏ãÈù¢ÁîüÊàêÁöÑÂåÖ/Êñá‰ª∂Âà∞È°πÁõÆÊñá‰ª∂ `com.becoze.usercenter` ‰∏ãÔºåÁÑ∂ÂêéÂà†Èô§ `generator` ÂåÖÔºö

* move `domain package` under `model` 
* move `userMapper field` under `mapper`
* move `impl package` under `service`

![image-20230504210432986](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230504210432986.png)

#### ÊµãËØï MyBatisX ÁîüÊàêÁöÑ‰ª£Á†Å

Áªô `UserService` ÂàõÂª∫‰∏Ä‰∏™ÊµãËØïÁ±ª„ÄÇ

go to file com.becoze.usercenter.service.UserService -> Put the cursor at `UserService` on the `public interface ...` code -> click alt+enter -> Create Test -> ...(see image) -> the OK

![image-20230504211934907](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230504211934907.png)

The code is generated on test.java.com.becoze.usercenter.service.UserServiceTest

##### ÊîæÂÖ•ÂÅáÊï∞ÊçÆ Set default value

> recommended plugin call GenerateAllSetter. it can generate all the setter methods, getter methods of an object with one click.

```java
@Test
public void testAddUser(){
	User user = new User();
}
```

select `user` -> click alt+enter -> "generate all setter with default value".

Remove all set function with a default value.

Fill-in test data.

```java
User user = new User();
user.setUsername("nick");
user.setUserAccount("123");       user.setAvatarUrl("https://raw.githubusercontent.com/becoze/becozePictureHosting/main/img/profile_img.jpg");
user.setGender(0);
user.setUserPassword("123456");
user.setPhone("0122");
user.setEmail("abc@sample.com");
```



##### ËæìÂá∫È™åËØÅ visualize result 

```java
boolean result  = userService.save(user);
System.out.println(user.getId());
Assertions.assertTrue(result);
```

> assert Êñ≠Ë®Ä„ÄÇ‰∏ªË¶ÅÊòØÂ∏Æ‰Ω†Êù•ÊµãËØïÁî®ÁöÑÔºåÊµãËØïÁ®ãÂ∫èÁöÑÂÆûÈôÖÊâßË°åÁªìÊûúÊòØÂê¶Á≠â‰∫é‰Ω†ÊúüÊúõÁöÑÁªìÊûú„ÄÇ

##### ‰ª£Á†Å

```java
package com.becoze.usercenter.service;
import java.util.Date;

import com.becoze.usercenter.model.domain.User;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import javax.annotation.Resource;


/**
 * User service test
 *
 * @author nick
 */
@SpringBootTest
public class UserServiceTest {

    @Resource
    private UserService userService;

    @Test
    public void testAddUser(){
        User user = new User();
        user.setUsername("nick");
        user.setUserAccount("123");
        user.setAvatarUrl("https://.xxxxx.jpg");
        user.setGender(0);
        user.setUserPassword("123456");
        user.setPhone("0122");
        user.setEmail("abc@sample.com");

        boolean result  = userService.save(user);
        System.out.println(user.getId());
        Assertions.assertTrue(result);
    }
}
```

##### ÂÖ≥Èó≠ÈªòËÆ§ËΩ¨Êç¢

`src.main.resources.application.yml` -> add following code

```yaml
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: false
```



##### ÊµãËØïÁªìÊûú

Run `testAddUser()`

![image-20230504220247748](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230504220247748.png)

Error

```
### Cause: java.sql.SQLSyntaxErrorException: Unknown column 'user_account' in 'field list'
```

**mybatis-plusÈªòËÆ§‰ºöÂ∞ÜÈ©ºÂ≥∞ËΩ¨Êç¢Êàê‰∏ãÂàíÁ∫ø**ÔºåÊâÄ‰ª•Â∞±Âá∫Áé∞Âú®‚ÄùÂ≠óÊÆµÂàóË°®‚Äù‰∏≠Âá∫Áé∞Êú™Áü•Âàó‚Äúuser_account'‚ÄùÔºåÂú®application.ymlÂÖ≥Èó≠ÈªòËÆ§ËΩ¨Êç¢

## ÂêéÁ´Ø - Ê≥®ÂÜåÔºàÊé•Âè£Ôºâ

### ÂàÜÊûêÊ≥®ÂÜåÈÄªËæë

1. Áî®Êà∑Âú®ÂâçÁ´ØËæìÂÖ•Ë¥¶Êà∑ÂíåÂØÜÁ†Å„ÄÅ‰ª•ÂèäÊ†°È™åÁ†ÅÔºàtodoÔºâ
2. Ê†°È™åÁî®Êà∑ÁöÑË¥¶Êà∑„ÄÅÂØÜÁ†Å„ÄÅÊ†°È™åÂØÜÁ†ÅÔºåÊòØÂê¶Á¨¶ÂêàË¶ÅÊ±Ç
   1. ÈùûÁ©∫
   2. Ë¥¶Êà∑ÈïøÂ∫¶ **‰∏çÂ∞è‰∫é** 4 ‰Ωç
   3. Ë¥¶Êà∑‰∏çËÉΩÈáçÂ§ç
   4. Ë¥¶Êà∑‰∏çÂåÖÂê´ÁâπÊÆäÂ≠óÁ¨¶
   5. ÂØÜÁ†ÅÂ∞± **‰∏çÂ∞è‰∫é** 8 ‰ΩçÔºàÂØÜÁ†ÅÊ†°È™åÊ≠£ÂàôË°®ËææÂºèÔºâ
   6. ÂØÜÁ†ÅÂíåÊ†°È™åÂØÜÁ†ÅÁõ∏ÂêåÔºà‰∫åÊ¨°ËæìÂÖ•ÂØÜÁ†ÅÔºâ
3. ÂØπÂØÜÁ†ÅËøõË°åÂä†ÂØÜÔºàÂØÜÁ†ÅÂçÉ‰∏á‰∏çË¶ÅÁõ¥Êé•‰ª•ÊòéÊñáÂ≠òÂÇ®Âà∞Êï∞ÊçÆÂ∫ì‰∏≠Ôºâ
4. ÂêëÊï∞ÊçÆÂ∫ìÊèíÂÖ•Áî®Êà∑Êï∞ÊçÆ

### ÂÆûÁé∞Ê≥®ÂÜåÂäüËÉΩ (ÁºñÂÜô‰ª£Á†Å)

go to `src.main.java.com.becoze.usercenter.service.UserService`

#### ÂÆö‰πâÊé•Âè£

```java

/**
 * @param userAccount user login account
 * @param userPassword user password 
 * @param checkPassword second-times password
 * @return new User id
 */
long userRegister(String userAccount, String userPassword, String checkPassword);
```



#### ÂÆûÁé∞Áî®Êà∑Ê≥®ÂÜåÂäüËÉΩ

**ÂäüËÉΩËÆæËÆ°**

üìå Ê†°È™åÁî®Êà∑ÁöÑË¥¶Êà∑„ÄÅÂØÜÁ†Å„ÄÅÁ°ÆËÆ§ÂØÜÁ†Å



**ÂºïÂÖ•‰æùËµñ**

ÂºïÂÖ•`Apache Common Lang` JavaÁ±ªÂ∫ìÔºö

> Got to [Maven Repository](https://mvnrepository.com/) -> search Apache Common Lang -> select the most popular version (3.12.0) -> copy `<dependency>` code -> pasted into pom.xml (under `mybatis-plus-boot-starter`) -> refresh

```xml
<!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
    <version>3.12.0</version>
</dependency>

```

> we gonna use the `StringUtils.` More specific `StringUtils.isAnyBlank()`

**ÂàõÂª∫ÂÆûÁé∞Á±ª**

ÂàõÂª∫Áî®Êà∑ÊúçÂä°ÂÆûÁé∞Á±ª Create service class: Select `userRegister(...)` -> alt+enter -> "implement method 'userRegister' " -> Write code ...



**Ê≠£ÂàôË°®ËææÂºè**


```java
String regex = "[^a-zA-Z0-9]";
Pattern pattern = Pattern.compile(regex);
Matcher matcher = pattern.matcher(userAccount);
// same as  
Matcher matcher = Pattern.compile("[^a-zA-Z0-9]").matcher(userAccount);
```

> Ê≠£ÂàôË°®ËææÂºè`[^a-zA-Z0-9]`ÔºöÂΩì `userAccount` ÈáåÂåÖÂê´Â§ßÂ∞èÂÜôÂ≠óÊØçÂíåÊï∞Â≠ó‰ª•Â§ñÁöÑÂ≠óÁ¨¶Êó∂ÔºàÂèäÁâπÊÆäÂ≠óÁ¨¶ÔºâÔºå`matcher` ‰∏∫ TRUE Âπ∂ËøîÂõû-1ÔºàÊãíÁªùÔºâ„ÄÇ



**ÊÄßËÉΩ‰ºòÂåñ**

> ÊääÊü•ËØ¢Êï∞ÊçÆÂ∫ìÁöÑ‚ÄúË¥¶Êà∑‰∏çËÉΩÈáçÂ§ç‚Äù**ÊîæÂà∞ÊúÄÂêé**Èù¢ÔºåÂõ†‰∏∫Êü•ËØ¢Êï∞ÊçÆÂ∫ìÊ∂àËÄóËÆøÈóÆËµÑÊ∫ê„ÄÇÂ¶ÇÔºöÁî®Êà∑ËæìÂÖ•Â∑≤Áªè‰∏çÁ¨¶ÂêàÂÖ∂‰ªñË¶ÅÊ±ÇÔºåÂ∞±Áõ¥Êé•ÁªìÊùüÁ®ãÂ∫èÔºåÁúÅÂéª‰∫Ü‰∏ÄÊ¨°Êü•ËØ¢Êï∞ÊçÆÂ∫ì„ÄÇ



#### ÂØπÂØÜÁ†ÅËøõË°åÂä†ÂØÜ

> `DigestUtils.xxx` Spring boot Ëá™Â∏¶ÁöÑÂä†ÂØÜÁ±ªÂ∫ì„ÄÇ

**‰ΩøÁî®ÊµãËØïÁ±ªÊµãËØï**

ÊµãËØïÊ†ºÂºèÔºö

```java
@Test
void testName() .... {
    ....
    System.out.println(result);
}
```



#### ÊèíÂÖ•Áî®Êà∑Êï∞ÊçÆ

> Long Âíå long ‰∏çËÉΩÊé•Êî∂null„ÄÇ
>
> `if(!saveResult) { return -1; }` ÊâÄ‰ª•Ë¶ÅÁî® `if` ËØ≠Âè•ÊäänullÊç¢ÊàêÂÖ∂‰ªñÔºàÂ¶ÇÔºö-1Ôºâ



#### UserService ÊúÄÁªà‰ª£Á†Å

```java
package com.becoze.usercenter.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.becoze.usercenter.model.domain.User;
import com.becoze.usercenter.service.UserService;
import com.becoze.usercenter.mapper.UserMapper;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Service;
import org.springframework.util.DigestUtils;

import javax.annotation.Resource;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
* @author nick
* User service implementation class
* 2023-05-04 20:45:36
*/
@Service
public class UserServiceImpl extends ServiceImpl<UserMapper, User>
    implements UserService{

    @Resource
    private UserMapper userMapper;
    @Override
    public long userRegister(String userAccount, String userPassword, String confirmPassword) {
        // 1. User Account & Password Verification
        // 1.1 User account, password and confirm-password can't be null
        if(StringUtils.isAnyBlank(userAccount, userPassword, confirmPassword)){
            return -1;
        }

        // 1.2 User Account can't be shorter than length of 4
        if(userAccount.length() < 4){
            return -1;
        }

        // 1.3 User password and confirm-password can't be shorter than length of 8
        if(userPassword.length() < 8 || confirmPassword.length() < 8){
            return -1;
        }

        // 1.4 User password must be same as confirm-password
        if(!userPassword.equals(confirmPassword)){
            return -1;
        }

        // 1.5 User account can't contain special characters
        String regex = "[^a-zA-Z0-9]";
        Matcher matcher = Pattern.compile(regex).matcher(userAccount);
        if(matcher.find()){
            return -1;
        }

        // 1.6 User account can't be duplicate (account already exist) [database query]
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("userAccount", userAccount);
        long count = userMapper.selectCount(queryWrapper);
        if(count > 0){
            return -1;
        }

        // 2. Password encryption
        final String SALT = "becoze";
        String encryptedPassword = DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());

        // 3. Insert data
        User user = new User();
        user.setUserAccount(userAccount);
        user.setUserPassword(encryptedPassword);
        boolean saveResult = this.save(user);
        if(!saveResult){    // prevent error from return "null" to Long / long
            return -1;
        }
        return user.getId();
    }
}
```



### ÁºñÂÜôÊµãËØïÁ±ªËøõË°åÊµãËØï

```java
@Test
void userRegister() {
    String userAccount;
    String userPassword;
    String confirmPassword;
    long result;

    // case 0: valid user registration
    userAccount = "validaccount";
    userPassword = "mypassword123";
    confirmPassword = "mypassword123";
    result = userService.userRegister(userAccount, userPassword, confirmPassword);
    Assertions.assertTrue(result > 0);

    // case 1: when user password or confirm-password is null
    userAccount = "becoze1234";
    userPassword = "1234567890";
    confirmPassword = "";           // <- wrong
    result = userService.userRegister(userAccount, userPassword, confirmPassword);
    Assertions.assertEquals(-1, result);

    // case 2: when user account is less than 4
    userAccount = "a";              // <- wrong
    userPassword = "123456";
    confirmPassword = "123456";
    result = userService.userRegister(userAccount, userPassword, confirmPassword);
    Assertions.assertEquals(-1, result);

    // case 3: when password is less than length of 8
    userAccount = "becoze1234";
    userPassword = "12345";         // <- wrong
    confirmPassword = "12345";
    result = userService.userRegister(userAccount, userPassword, confirmPassword);
    Assertions.assertEquals(-1, result);

    // case 4: when password different from confirm-password
    userAccount = "becoze1234";
    userPassword = "1234567890";
    confirmPassword = "abcdefghjk"; // <- wrong
    result = userService.userRegister(userAccount, userPassword, confirmPassword);
    Assertions.assertEquals(-1, result);

    // case 5: when user account contain special character(s)
    userAccount = "becoze 1234";    // <- wrong
    userPassword = "1234567890";
    confirmPassword = "1234567890";
    result = userService.userRegister(userAccount, userPassword, confirmPassword);
    Assertions.assertEquals(-1, result);

    // case 6: when new account duplicate with existing account
    userAccount = "validaccount";   // <- wrong (duplicated)
    userPassword = "1234567890";
    confirmPassword = "1234567890";
    result = userService.userRegister(userAccount, userPassword, confirmPassword);
    Assertions.assertEquals(-1, result);
}
```

> DROP user account `validaccount` before run the Test second time or if already have one. Because it will be "duplicate user" and throw a error.
>
> `DELETE from user WHERE userAccount = 'validaccount';`

then go to Database -> @localhost -> nautilus -> tables -> user. It should There will only be ONE extra user named `validaccount`, all those test account such as `a`, `becoze1234`, and `becoze 1234` are rejected.
