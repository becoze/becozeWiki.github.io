# è®¡åˆ’

1. åˆå§‹åŒ–é¡¹ç›® âœ”

   1. å‰ç«¯åˆå§‹åŒ–  âœ”

      1. åˆå§‹åŒ–é¡¹ç›® 
      2. å¼•å…¥ä¸€äº›ç»„ä»¶ä¹‹ç±»çš„ 
      3. æ¡†æ¶ä»‹ç» / ç˜¦èº« 

   2. åç«¯åˆå§‹åŒ–  20 min  âœ”

      1. å‡†å¤‡ç¯å¢ƒï¼ˆMySQL ä¹‹ç±»çš„ï¼‰éªŒè¯ MySQL æ˜¯å¦å®‰è£…æˆåŠŸ - è¿æ¥ä¸€ä¸‹ 
      2. åˆå§‹åŒ–åç«¯é¡¹ç›®ï¼Œå¼•å…¥æ¡†æ¶ï¼ˆæ•´åˆæ¡†æ¶ï¼‰
2. æ•°æ®åº“è®¾è®¡  âœ”
3. **ç™»å½• / æ³¨å†Œ** ğŸ“Œ
   1. åç«¯  âœ”
      1. è§„æ•´é¡¹ç›®ç›®å½•  âœ”
      2. å®ç°åŸºæœ¬æ•°æ®åº“æ“ä½œï¼ˆæ“ä½œ user è¡¨ï¼‰ âœ”
         1. æ¨¡å‹ user å¯¹è±¡ => å’Œæ•°æ®åº“çš„å­—æ®µå…³è”ï¼Œè‡ªåŠ¨ç”Ÿæˆ  âœ”
         1. æµ‹è¯• âœ”
      3. å†™æ³¨å†Œé€»è¾‘ï¼ŒåŠŸèƒ½å’Œæµ‹è¯• âœ”
      4. å†™ç™»å½• åŠŸèƒ½å’Œæµ‹è¯• âœ”
         1. å¼€å‘å®Œæˆåç«¯ç™»å½•åŠŸèƒ½ï¼ˆå…ˆå•æœºç™»å½• => åç»­æ”¹é€ ä¸ºåˆ†å¸ƒå¼ / ç¬¬ä¸‰æ–¹ç™»å½•ï¼‰âœ”
         2. ï¼ˆç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†ï¼‰å¼€å‘åç«¯ç”¨æˆ·çš„ç®¡ç†æ¥å£ï¼Œç”¨æˆ·çš„æŸ¥è¯¢ / çŠ¶æ€æ›´æ”¹ã€‚âœ”
         3. åç«¯æ¥å£æµ‹è¯• âœ”
   2. å‰ç«¯ ğŸ“Œ
      1. ï¼ˆç»§ç»­ï¼‰åˆ é™¤å¤šä½™ä»£ç  ğŸ“Œ
      2. æ³¨å†ŒåŠŸèƒ½ âœ”
      3. è·å–ç”¨æˆ·çš„ç™»å½•æ€ï¼Œ**è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯æ¥å£**  âœ”
      4. å¼€å‘å‰ç«¯ç”¨æˆ·ç™»å½•æ³¨å†ŒåŠŸèƒ½ ğŸ“Œ
      5. è®¨è®ºå¦‚ä½•æ ¡éªŒç”¨æˆ·ï¼ˆæ˜Ÿçƒçš„å°ä¼™ä¼´å¯ä»¥ä½¿ç”¨ï¼‰ğŸ“Œ
4. **ç”¨æˆ·æ³¨é”€**ğŸ“Œ
5. ç®¡ç†å‘˜ï¼Œç”¨æˆ·ç®¡ç†ğŸ“Œ

   2. åç«¯
   2. å‰ç«¯ ğŸ“Œ



# ç»ˆ - ç›´æ’­å†…å®¹ï¼š

1. å®Œæˆæ³¨å†ŒåŠŸèƒ½çš„å‰ç«¯å¼€å‘ 15 - 20min âˆš

2. è·å–ç”¨æˆ·çš„ç™»å½•æ€ï¼Œ**è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯æ¥å£**  âˆš

3. å®Œæˆç”¨æˆ·ç®¡ç†åå°çš„å‰ç«¯å¼€å‘ 20 - 30 min

4. å‰ç«¯ä»£ç ç˜¦èº« & ä¼˜åŒ– 20min

   1. å‰ç«¯å¯†ç é‡å¤æç¤ºï¼ˆå¯èƒ½æœ‰åˆ«çš„ä¼˜åŒ–æ–¹å¼ï¼‰

   2. æ³¨å†Œæ²¡æœ‰å‹å¥½çš„æç¤º
   3. **ç”¨æˆ·æ³¨é”€**
   4. ä¼˜åŒ–æŸ¥è¯¢æ¥å£ï¼ˆæ”¯æŒæ›´å¤šæŸ¥è¯¢ï¼‰

5. åç«¯ä»£ç ä¼˜åŒ– 20min

6. æ–°éœ€æ±‚ - è®¨è®ºåŠå¼€å‘æ˜Ÿçƒç”¨æˆ·æ ¡éªŒï¼ˆç®€æ˜“ï¼‰ ---

7. é¡¹ç›®æ‰©å±•æ€è·¯

   

   ä»Šæ—¥è®¡åˆ’

   1. å¼€å‘å®Œæˆåç«¯ç™»å½•åŠŸèƒ½ 20 minï¼ˆå•æœºç™»å½• => åç»­æ”¹é€ ä¸ºåˆ†å¸ƒå¼ / ç¬¬ä¸‰æ–¹ç™»å½•ï¼‰âœ”
   2. å¼€å‘åç«¯ç”¨æˆ·çš„ç®¡ç†æ¥å£ 5 minï¼ˆç”¨æˆ·çš„æŸ¥è¯¢ / çŠ¶æ€æ›´æ”¹ï¼‰âœ”
   3. åç«¯æ¥å£æµ‹è¯• âœ”
   4. å¼€å‘å‰ç«¯ç”¨æˆ·ç™»å½•æ³¨å†ŒåŠŸèƒ½ 40 min - 1h
   5. è®¨è®ºå¦‚ä½•æ ¡éªŒç”¨æˆ·ï¼ˆæ˜Ÿçƒçš„å°ä¼™ä¼´å¯ä»¥ä½¿ç”¨ï¼‰

# å‰ç«¯ - ä¿®æ”¹UI

## ä¿®æ”¹ i18n é»˜è®¤è¯­è¨€

æ‰¾åˆ° `config.config.js`ï¼Œæ‰¾åˆ° `locale` ä»¥ä¸‹ä»£ç ï¼Œä¿®æ”¹ `default:` åˆ°éœ€è¦çš„è¯­è¨€ã€‚

```tsx
locale: {
    // default zh-CN
    default: 'en-US',
    antd: true,
     // default true, when it is true, will use `navigator.language` overwrite default
    baseNavigator: true,
},
```



## ä¿®æ”¹footer

æ‰¾åˆ° `src.pages.user.Login.index.tsx`ã€‚

æŒ‰ ctrl+shift+- æŠ˜å å…¨éƒ¨ä»£ç ã€‚ç„¶åä¸€çº§ä¸€çº§æ‰“å¼€ä»£ç ã€‚

æ‰¾åˆ° `<Footer />`ï¼Œctrl+é¼ æ ‡ç‚¹å‡» Footerï¼Œè¿›å…¥åˆ° `Footer\index.tsx`ã€‚![image-20230517183052295](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230517183052295.png)

æ ¹æ®éœ€æ±‚ä¿®æ”¹ `DefaultFooter` é‡Œçš„ `links={[ ... ]}`ã€‚

```tsx
<DefaultFooter
    copyright={`${currentYear} ${defaultMessage}`}
    links={[
        {
            key: 'LinkedIn Profile',
            title: <><LinkedinOutlined /> Liyuan-L LinkedIn</>,
            href: 'https://www.linkedin.com/in/liyuan-liang/',
            blankTarget: true,
        },
        {
            key: 'github',
            title: <><GithubOutlined /> becoze Github</>,
            href: 'https://github.com/becoze',
            blankTarget: true,
        },
        {
            key: 'email',
            title: <><MailOutlined /> contact email</>,
            href: 'https://www.linkedin.com/in/liyuan-liang/overlay/contact-info/',
            blankTarget: true,
        },
    ]}
    />
```



æ‰¾åˆ° `'app.copyright.produced': '...' æŠŠé‡Œé¢çš„ `ant design ...` å¥å­åˆ æ‰ã€‚

è¿›å…¥åˆ° `Footer\index.tsx`ã€‚åœ¨æ ¹æ®éœ€æ±‚ä¿®æ”¹ `defaultMessage: '...'`ã€‚



## ä¿®æ”¹logo

åœ¨ `src` ä¸‹åˆ›å»ºä¸€ä¸ª `constants` ï¼ˆåŠ  â€˜sâ€™ï¼‰æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹é‡Œåˆ›å»ºä¸€ä¸ª `index.ts` æ–‡ä»¶ã€‚ç”¨äºç»Ÿä¸€ç®¡ç†ç³»ç»Ÿå¸¸é‡ã€‚

æŠŠå›¾ç‰‡çš„çº¿ä¸Šåœ°å€å¤åˆ¶è¿›å»ã€‚

```
export const SYSTEM_LOGO = "xxxxxx";
```

å»åˆ° `src.pages.user.Login.index.tsx` ï¼Œåœ¨ `src` é‡Œæ”¹æˆ `SYSTEM_LOGO`ã€‚ï¼ˆErrorï¼šå¦‚æœæ²¡æœ‰è‡ªåŠ¨ `import`ï¼Œå¯ä»¥æ‰‹åŠ¨ï¼‰

 ```tsx
import {SYSTEM_LOGO} from "@/constants";
...
<LoginForm
    logo={<img alt="logo" src={SYSTEM_LOGO} />}
 ```



## ä¿®æ”¹Title / Sub-Title

```tsx
<LoginForm
    logo={<img alt="logo" src={SYSTEM_LOGO} />}
    title="becoze UserCenter"
    subTitle={intl.formatMessage({ id: 'pages.layouts.userLayout.title' })}
```



## åˆ é™¤ä¸éœ€è¦çš„åŠŸèƒ½

åˆ é™¤å…¶ä»–ç™»å½•æ–¹å¼ï¼š

```tsx
actions={[
         <FormattedMessage
         ...
         />,
       ...
   		<WeiboCircleOutlined key="WeiboCircleOutlined" className={styles.icon} />,
         ]}
```

åˆ é™¤æ‰‹æœºå·ç™»å½•ï¼š

```tsx
<Tabs.TabPane
    key="mobile"
    tab={...
        defaultMessage: 'æ‰‹æœºå·ç™»å½•',
    })}
    />
```

åˆ é™¤æ‰‹æœºéªŒè¯ç ï¼š

```tsx
{status === 'error' && loginType === 'mobile' && <LoginMessage content="éªŒè¯ç é”™è¯¯" />}
```



åˆ é™¤æ•´ä¸ªæ‰‹æœºå·ç™»å½•ç•Œé¢æ¸²æŸ“ï¼š

```tsx
{type === 'mobile' && (
	<...>
)}
```



## ä¿®æ”¹åŠŸèƒ½

åªåˆ æ‰ç™»å½•å¤±è´¥æ—¶ç”¨æˆ·åæç¤º `(admin/ant.design)`ï¼š

```tsx
<LoginMessage
    content={intl.formatMessage({
    id: 'pages.login.accountLogin.errorMessage',
    defaultMessage: 'è´¦æˆ·æˆ–å¯†ç é”™è¯¯',
    })}
/>
```

ä¿®æ”¹ placeholderï¼š

```tsx
placeholder={intl.formatMessage({
    id: 'pages.login.username.placeholder',
    defaultMessage: 'Username',
})}
```

å¿˜è®°å¯†ç ï¼Œæ·»åŠ è·³è½¬ `href` ç­‰ï¼š

```tsx
<a
    style={{
        float: 'right',
    }}
    href={LinkedIn_contact}
    target="_blank"
    rel="noreferrer"
    >
        <FormattedMessage id="pages.login.forgotPassword" defaultMessage="Forgot password?" />
</a>
```

## ç®€æ´å



![image-20230518210602204](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230518210602204.png)



# å‰ç«¯ - å¼€å‘æ³¨å†ŒåŠŸèƒ½

ç”¨ debug æ¨¡å¼è·‘**åç«¯ç³»ç»Ÿ**ã€‚

ç”¨æœ¬åœ°è°ƒè¯• `sratr:dev` å¯åŠ¨**å‰ç«¯ç³»ç»Ÿ**ã€‚

å°è¯•ä½¿ç”¨ `validaccount` å’Œ `mypassword123` ç™»å½•ã€‚

## å¢åŠ æ³¨å†Œé¡µé¢

æ‰¾åˆ° `src.pages.user.Login`ã€‚

> å¯æ ¹æ® `config.routes.ts` è·¯ç”±é‡ŒæŸ¥çœ‹ç™»å½•æ—¶ç”¨åˆ°çš„è·¯ç”±ã€‚

å¤åˆ¶ `src.pages.user.Login` åˆ°å½“å‰ `Login` åœ¨çš„ç›®å½•ï¼Œå‘½åä¸º `Registerã€‚`

![image-20230525185914793](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230525185914793.png)

è¿›å…¥åˆ° `Register.index.tsx`ï¼Œctrl + f æŠŠç»„æ‰€æœ‰ä»¶å `Login` ä¿®æ”¹æˆ `Register`ã€‚ï¼ˆå…±2ä¸ªç»„ä»¶åï¼Œä¸åŒ…æ‹¬å˜é‡åï¼‰

```tsx
const Register: React.FC = () => {
    ...
}
export default Register;
```



>å°½é‡ç»™æ¯ä¸ªé¡µé¢éƒ½ç»™å®ƒå”¯ä¸€çš„ä¸€ä¸ªåç§°ã€‚
>
>ä¸è¦æ‰€æœ‰å¤åˆ¶ç²˜è´´è¿‡æ¥çš„é¡µé¢å…¨ç”¨ä¸€æ ·çš„åç§°ï¼Œè¿™æ ·ä¹‹åé‡æ„æˆ–ä¿®æ”¹çš„æ—¶å€™ï¼Œå¯èƒ½å°±ä¸å°å¿ƒæŠŠåˆ«çš„é¡µé¢çš„ä»£ç ä¹Ÿå½±å“äº†ã€‚

æŠŠæ²¡ç”¨åˆ°çš„å¼•å…¥ `import` åˆ é™¤ã€‚



## æ·»åŠ è·¯ç”±

å»åˆ° `config.routes.ts` è·¯ç”±ã€‚æ–°å»ºä¸€ä¸ª `Register` è·¯ç”±ã€‚

```tsx
routes: [
    {name: 'login', path: '/user/login', component: './user/Login',},
    {name: 'register', path: '/user/register',component: './user/Register', },
    {component: './404',},
],
```

> æˆ‘ä»¬ç°åœ¨æ˜¯ç”¨äº† `react router` è¿™æ ·ä¸€ä¸ªè·¯ç”±ç»„ä»¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠuå’Œå†™çš„é¡µé¢ç»„ä»¶å…³è”ä¸Šï¼Œè¿™æ ·çš„è¯ç”¨æˆ·è®¿é—®æŸä¸€ä¸ªåœ°å€ã€‚
>
> æ¯”å¦‚è¯´è®¿é—®å®ƒ `localhost:8000/user/register` çš„æ—¶å€™ï¼ŒæŒ‡å®šä¸€ä¸ªæˆ‘ä»¬å†™çš„ç»„ä»¶çš„ä½ç½®ï¼Œæ¯”å¦‚è¯´ `user/register`ï¼Œå®ƒå°±ä¼šæ‰¾åˆ°useré…ç½®ç›®å½•ä¸‹çš„ `register`ã€‚

æŒ‰ä¸‹ ctrl + alt + l å¿«é€Ÿæ ¼å¼åŒ–ã€‚



## ä¼˜åŒ–é»˜è®¤æ¡†æ¶ï¼ˆè§£å†³è·³è½¬Errorï¼‰ 

æ­¤æ—¶è¿˜ä¸èƒ½æ­£ç¡®åœ°è®¿é—®  `localhost:8000/user/register` é¡µé¢ã€‚åˆæ­¥åˆ¤æ–­å¯èƒ½æ˜¯ï¼šç›´æ¥å¤åˆ¶çš„ç™»å½•é€»è¾‘å¼ºåˆ¶è·³è½¬ç”¨æˆ·åˆ°ç™»å½•ç•Œé¢ã€‚

### æ’æŸ¥ 1 - `Login` ä»£ç é€»è¾‘ï¼š

å»åˆ°  `Register.index.tsx`ã€‚

æ³¨é‡Šæ‰ `const Register: React.FC = () => {..}` é‡ŒåŒæ—¶ `return` å¤–çš„æ‰€æœ‰ä»£ç é€»è¾‘ã€‚

```tsx
const Register: React.FC = () => {
	// const [userLoginState, setUserLoginState] = useState<API.LoginResult>({});
    // ...
    // const { status, type: loginType } = userLoginState;
  
  return (
  	// ...
  )
```

æ³¨é‡Šæ‰ `return` é‡Œçš„ `<LoginForm` çš„æ‰€æœ‰ä»£ç é€»è¾‘ã€‚

```html
<div className={styles.content}>
    {/*<LoginForm*/}
		...
	{/*</LoginForm>*/}
```

ä¸ç”¨ç®¡æŠ¥é”™ã€‚ç›´æ¥å°è¯•è®¿é—® `localhost:8000/user/register`ã€‚è¿˜æ˜¯ä¸è¡Œã€‚



### æ’æŸ¥ 2 - `app.tsx` æ ¸å¿ƒæ–‡ä»¶

å¯åœ¨ `app.tsx` æ–‡ä»¶ä¸­æ’å…¥ `alert(1)` å¼¹å‡ºæç¤ºæ¡†ï¼Œæ¥æ£€æŸ¥è§¦å‘äº†å“ªäº›å…¨å±€é€»è¾‘ã€‚ `alert(1);`  å¯æ’å…¥åœ¨å¦‚ä»¥ä¸‹ä½ç½®ï¼š

```tsx
export async function getInitialState(): Promise<{
    ...
}> {
    alert(1);
    const fetchUserInfo = async () => {
        try {
            ...
        }
    };
```

> F5 åˆ·æ–°é¡µé¢ï¼Œå‡ºç°å¼¹çª—å†…å®¹æ˜¯ "1"ï¼›ä»£è¡¨è¿™æ®µé€»è¾‘ä¼šåœ¨æˆ‘ä»¬è®¿é—®ç™»å½•é¡µé¢æ—¶æ‰§è¡Œã€‚

åˆ æ‰ `alert(1)`ã€‚

`app.tsx` å®šä¹‰äº†ä¸ªå…¬å…±å¸¸æ•°ç±»å‹ï¼Œ`loginPath` æŒ‡å‘ `/user/login`ã€‚å¯èƒ½å’Œè¿™æœ‰å…³ã€‚

```tsx
const loginPath = '/user/login';
```

ctrl + f æœç´¢ `loginPath`ã€‚æŸ¥çœ‹æ‰€æœ‰çš„ç”¨åˆ°çš„åœ°æ–¹ã€‚å‘ç° `history.push(loginPath);`ã€‚

æŠŠæ‰€æœ‰çš„ `history.push(loginPath);` **åŒæ—¶æ³¨é‡Šæ‰**ç¡®å®èƒ½é˜»æ­¢è‡ªåŠ¨è·³è½¬åˆ° `/user/login` é¡µé¢ã€‚

> `history.push(loginPath)` å…¶ä¸­ `loginPath` ç­‰äº `user.Login`ã€‚ç›¸å½“äºè·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚

åŒæ—¶å¯ä»¥åœ¨ `history.push(loginPath);` é™„è¿‘æ‰¾åˆ° `onPageChange`ã€‚åŠ ä¸Š `alert(1)` æµ‹è¯•æ˜¯å¦è¢«æ‰§è¡Œã€‚ï¼ˆç„¶ååˆ é™¤ alertï¼‰

> `alert(1)` æµ‹è¯•ç»“æœï¼šæ¯æ¬¡åˆ‡æ¢é¡µé¢éƒ½ä¼šè§¦å‘ã€‚
>
> `onPageChange` **æ¯æ¬¡**æˆ‘ä»¬è·³è½¬é¡µé¢ï¼Œå°±ä¼šæ‰§è¡Œä»¥ä¸‹é€»è¾‘ï¼šæ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•ï¼Œé‡å®šå‘åˆ° `user/Login`ã€‚

```tsx
onPageChange: () => {
    alert(1);
    ...
    if (...) {
        history.push(loginPath);
    }
},
```

### è§£å†³æ–¹æ³•

**è§£å†³ç¬¬ä¸€ä¸ª `push(loginPath)`**

æ³¨é‡Šæ‰ç¬¬ä¸€ä¸ª `history.push(loginPath);`

```tsx
const fetchUserInfo = async () => {
	...
    } catch (error) {
        // history.push(loginPath);
    }
};
```



**è§£å†³ç¬¬äºŒä¸ª `push(loginPath)`**

æ‰¾åˆ° `onPageChange: () => {...}` çš„ `history.push(loginPath)` ä»£ç ã€‚

åˆ›å»ºç™½åå•`whiteList`ï¼Œå¯ä»¥å…è®¸åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹è·³è½¬åˆ°ç™½åå•ä¸Šçš„é¡µé¢å¦‚ï¼š`Register` å’Œè‡ªå¸¦çš„ `loginPath`ï¼š

```tsx
onPageChange: () => {
    const { location } = history;
    const whiteList = ['/user/register', loginPath];
    if(whiteList.includes(location.pathname)){
        return;
    }
    // å¦‚æœæ²¡æœ‰ç™»å½•ï¼Œé‡å®šå‘åˆ° login
    if (!initialState?.currentUser && location.pathname !== loginPath) {
        history.push(loginPath);
    }
```

> å¦‚æœç”¨æˆ·è®¿é—®çš„æ˜¯ç™½åå•é‡Œçš„é¡µé¢ï¼Œå°±ç›´æ¥ `return`ï¼Œä¸ç”¨é‡å®šå‘ã€‚å¦åˆ™ï¼Œæ²¡ç™»é™†çš„è¯å°±ä¼šè¢«é‡å®šå‘åˆ° `Login`ã€‚



### ä¸ºä»€ä¹ˆä¼šç®€å•ç²—æš´åœ°è·³è½¬åˆ°ç™»å½•é¡µé¢

>ä¸»è¦å°±æ˜¯å› ä¸º `app.tsx`å®ƒæ˜¯å’±ä»¬è¿™ä¸ªå‰ç«¯é¡¹ç›®çš„å…¨å±€æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº†åˆšè¿›å…¥ä¸€ä¸ªé¡µé¢æ—¶è¦æ‰§è¡Œçš„é€»è¾‘ã€‚
>
>å› ä¸ºè¿™ä¸ªæ¡†æ¶æ›´åå‘äºåå°ç®¡ç†ç³»ç»Ÿï¼šæ¯ä¸ªé¡µé¢éƒ½ä¼šå»æ ¡éªŒç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œåªè¦ç”¨æˆ·æ²¡æœ‰ç™»å½•çŠ¶æ€ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚



## å®ç°æ³¨å†ŒåŠŸèƒ½

å»åˆ° `Register.index.tsx` ã€‚

**æ¢å¤ä¹‹å‰æ³¨é‡Šæ‰çš„ä»£ç **

æ¢å¤ `Register.index.tsx` æ‰€æœ‰åœ¨ "æ’æŸ¥ 1 - `Login` ä»£ç é€»è¾‘" æ­¥éª¤ä¸­æ³¨é”€çš„ä»£ç ã€‚



### åˆ æ‰ä¸éœ€è¦çš„åŠŸèƒ½

åˆ é™¤ `const fetchUserInfo` è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚å’Œå…¶ä»–åœ°æ–¹çš„ `await fetchUserInfo();`ã€‚

```tsx
const { initialState, setInitialState } = ...;

const fetchUserInfo = async () => {
    const userInfo ...
    if ...
};
    
...
await fetchUserInfo();
    
```



åˆ é™¤è‡ªåŠ¨ç™»å½• `<ProFormCheckbox noStyle name="autoLogin"`ã€‚

```tsx
<ProFormCheckbox noStyle name="autoLogin">
    <FormattedMessage ... />
</ProFormCheckbox>
```

åˆ é™¤ "å¿˜è®°å¯†ç " çš„ `<div ...`ã€‚

```tsx
<div
    style={{marginBottom: 24,}}
    >
    <a
        ...
    >
        <FormattedMessage ... = "Forgot password?" />
    </a>
</div>
```



### ä¿®æ”¹æ–‡æœ¬ä»£ç 

ä¿®æ”¹ `<LoginForm` é‡Œçš„ "è´¦å·å¯†ç ç™»å½•"ï¼Œæ”¹æˆ "æ³¨å†Œ"ã€‚

å…¶ä»–ï¼šæ ¹æ®éœ€æ±‚ä¿®æ”¹æ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯ï¼š

**type 1:**

```tsx
anyName={intl.formatMessage({
	id: 'pages.login.accountLogin.tab',
	defaultMessage: "Register Account",
})}
```

æ”¹æˆ

```tsx
[Name]={"[content]"}
// for example: 
tab={"Register Account"}
```



**type 2:**

```tsx
message: (
    <FormattedMessage
        id="pages.login.password.required"
        defaultMessage="Please enter Password!"
     />
),
```

æ”¹æˆ

```tsx
message: 'Please enter Password',
```



#### Error - 'æ³¨å†Œ' æŒ‰é’®æ–‡å­—é”™è¯¯

è§£å†³ï¼š

ctrl + b ï¼ˆä¸€æ¬¡ï¼‰è¿›å…¥ `LoginForm` æºç  `index.d.ts`ã€‚

å·¦ä¾§ `project` -> æ˜¾ç¤ºå½“å‰æ–‡æ¡£ä½ç½®ã€‚

![image-20230619191444522](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230619191444522.png)

å½“å‰åœ¨ `LoginForm.index.d.js`ã€‚ç„¶åè¿›å…¥åˆ°ä¸‹é¢çš„ `index.js` -> ctrl + f æœç´¢ "ç™»å½•" å…³é”®å­— -> æ‰¾åˆ°ä»¥ä¸‹ï¼š

```js
var submitter = proFormProps...({
    searchConfig: {
        submitText: intl.getMessage('loginForm.submitText', 'ç™»å½•')
    },
```

> æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ç»“æ„æ˜¯ `submitter` -> `searchConfig`: -> `submitText`.

å¾—çŸ¥å¯ä»¥é€šè¿‡ä¿®æ”¹ æäº¤æ–‡æœ¬ `submitText` ä¿®æ”¹æ˜¾ç¤ºæ–‡æœ¬ã€‚

å›åˆ° `Register.index.tsx` åœ¨ `<LoginForm` é‡ŒåŠ å…¥ä»¥ä¸‹ä»£ç ã€‚

```tsx
<LoginForm
    submitter={{
        searchConfig: {
            submitText: 'Register'
        }
    }}
    logo=...
    title=...
    ...
```





### å®ç°ç”¨æˆ·è¾“å…¥æ¡†

æ‰¾åˆ° HTML å¯†ç è¾“å…¥æ¡† `<ProFromText.Password `ï¼Œå¹¶å¤åˆ¶ä¸€ä»½ï¼Œæ”¹æˆ "ç¡®è®¤å¯†ç  `comfirmPassword`" è¾“å…¥æ¡†ã€‚  

â€‹	ä¿®æ”¹ `name`ã€‚

â€‹	ä¿®æ”¹ `placeholder`ã€‚

```tsx
<ProFormText.Password
	name="confirmPassword"
```

> æ³¨å†Œéœ€è¦3ä¸ªç”¨æˆ·è¾“å…¥ï¼šè´¦å·ï¼Œå¯†ç ï¼Œå’Œç¡®è®¤å¯†ç ã€‚

ä½¿ç”¨ctrl + fï¼Œä¿®æ”¹å…¨éƒ¨çš„ "ç™»å½•" æ¢æˆ "æ³¨å†Œ"ã€‚å¦‚ï¼šæ˜¾ç¤ºï¼Œæ³¨é‡Šç­‰ã€‚





### å®ç°æ³¨å†Œæäº¤é€»è¾‘

#### å®šä¹‰æ³¨å†Œå‚æ•°

åœ¨ `Register.index.tsx` æ‰¾åˆ° `onFinish`ã€‚ 

```tsx
onFinish={async (values) => {
    await handleSubmit(values as API.LoginParams);
}}
```

> å½“æäº¤é¡µé¢æ—¶ï¼Œè§¦å‘ `onFinish` é‡Œé¢çš„æ–¹æ³•ã€‚

ctrl + b è¿›å…¥ `LoginParams` æ‰€åœ¨çš„æ–¹æ³•ã€‚

å¤åˆ¶ä¸€ä»½`type LoginParams = {...}` å¹¶æ”¹ä¸º `RegisterParams`ï¼Œä»¥æ·»åŠ æ³¨å†Œçš„å‚æ•°ã€‚

```tsx
type RegisterParams = {
    userAccount?: string;
    userPassword?: string;
    autoLogin?: boolean;
    type?: string;
  };
```

åˆ æ‰ `autoLogin?: boolean;`ï¼Œæ·»åŠ  `confirmPassword?: string;`ã€‚

```tsx
type RegisterParams = {
    userAccount?: string;
    userPassword?: string;
    confirmPassword?: string;
    type?: string;
  };
```

> `[name]?: string;` å…¶ä¸­çš„ ? ä»£è¡¨å½“å‰å±æ€§æ˜¯å¯é€‰çš„ï¼Œä¸ä¸€å®šå­˜åœ¨ã€‚

åœ¨ `Register.index.tsx` é‡Œï¼Œä½¿ç”¨ ctrl + fï¼Œæ›¿æ¢æ‰€æœ‰ `LoginParams` æˆ `RegisterParams`ã€‚å…±ä¸¤å¤„ï¼š

```tsx
const handleSubmit = async (values: API.RegisterParams) => {
	try {...}
}

return (
...
onFinish={async (values) => {
    await handleSubmit(values as API.RegisterParams);
          }}
...
```

åœ¨æ–¹æ³•å¼€å¤´ï¼ŒæŠŠå‚æ•°å°è£…æˆ `values`ï¼Œç”¨äºæŠŠæ•°å€¼ä»å‚æ•°é‡Œå–å‡ºæ¥ï¼Œæ–¹ä¾¿ä½¿ç”¨ï¼š

```tsx
const handleSubmit = async (values: API.RegisterParams) => {
    const {userPassword, confirmPassword} = values;
    ...
```



#### æ·»åŠ å¯†ç æ ¡éªŒ

æ·»åŠ ä»¥ä¸‹æ ¡éªŒï¼Œåˆ¤æ–­ `Password` æ˜¯å¦åŒ¹é… `confirmPassword`ã€‚

```tsx
const handleSubmit = async (values: API.RegisterParams) => {
    const {userPassword, confirmPassword} = values;
    // verify
    if(userPassword !== confirmPassword){
        message.error('Password and Confirm Password not match!');
        return;
    }
    ...
```





#### å®ç°æ³¨å†Œé€»è¾‘

æŠŠ `value` ä¼ è¿›æ–¹æ³•ï¼Œä¿®æ”¹ `const user = await` ä»£ç ï¼š

```tsx
try {
    // Register
    const user = await login(value);
```

åŒä¸€è¡Œä»£ç ï¼Œctrl + b è¿›å…¥ `login`ï¼Œåˆ° `api.ts`ã€‚

> `api.ts` å®šä¹‰äº†æ‰€æœ‰å‘åç«¯å‘é€çš„è¯·æ±‚çš„å‡½æ•°ã€‚é€šå¸¸æ—¶ç›´æ¥è¯·æ±‚ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ã€‚

å¤åˆ¶ä¸€ä»½ `login(...){...}` ä»£ç ï¼Œå¹¶é‡å‘½åä¸º `register`ã€‚

ä¿®æ”¹ä¼ å…¥å‚æ•° `body: API.RegisterParams`ã€‚

ä¿®æ”¹ api æ¥å£ `/api/user/register`ã€‚ï¼ˆå¯ä»¥å»åç«¯çš„ `controller.UserController` é‡Œç¡®è®¤ï¼‰ã€‚

```tsx
export async function register(body: API.RegisterParams, options?: { [key: string]: any }) {
  return request<API.LoginResult>('/api/user/register', {
    ...
}
```

ctrl + b è¿›å…¥ `LoginResult`ã€‚

å¤åˆ¶ä¸€ä»½ `type LoginResult = {...}`ï¼Œé‡å‘½åä¸º `RegisterResult`ã€‚

ä¿®æ”¹å‚æ•°æˆï¼š

```tsx
type RegisterResult = number;
```

> ä»åç«¯çš„ `service.UserService` å¯ä»¥ç¡®è®¤ï¼Œ`Register` è¿”å›çš„å°±ä¸€ä¸ª Long ç±»å‹çš„ç”¨æˆ·idï¼Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆåŒ…å«idï¼‰ã€‚æ‰€ä»¥ç›´æ¥ç”¨ `=string` æ¥æ”¶ã€‚

å›åˆ° `api.ts`ï¼Œä¿®æ”¹ `<API.RegisterResult>`ã€‚

å›åˆ° `Register.index.tsx`ï¼Œä¿®æ”¹å˜é‡å(id)å’Œæ–¹æ³•(register)ã€‚

```tsx
try {
    // Register
    const id = await register(values);
```

> æŠ¥é”™æ…¢æ…¢æ”¹ã€‚



**å¥—ç”¨æ–°çš„æ³¨å†Œé€»è¾‘** 

```tsx
try {
    // Register
    const id = await register(values);

    if (id > 0) {
        const defaultLoginSuccessMessage = intl.formatMessage({
            ...
        });
        message.success(defaultLoginSuccessMessage);
        /** æ­¤æ–¹æ³•ä¼šè·³è½¬åˆ° redirect å‚æ•°æ‰€åœ¨çš„ä½ç½® */
        if (!history) return;
        const { query } = history.location;
        const { redirect } = query as { redirect: string };
        history.push('/user/login?redirect=' + redirect);
        return;
    }else {
        throw new Error(`register error id = ${id}`)
    }
} catch (error) {
    const defaultLoginFailureMessage = intl.formatMessage({
        ...
    });
    message.error(defaultLoginFailureMessage);
}
```



#### (åˆ é™¤ä¸éœ€è¦çš„ä»£ç )

åˆ é™¤ `LoginMessage` ç›¸å…³ã€‚

```tsx
const LoginMessage: React.FC<{
    content: string;
}> = ({ content }) => (
    <Alert
        style={{
            marginBottom: 24,
        }}
        message={content}
        type="error"
        showIcon
        />
);
```

åˆ é™¤ `login state` ç›¸å…³ã€‚

```tsx
const [userLoginState, setUserLoginState] = useState<API.LoginResult>({});
...
const { status, type: loginType } = userLoginState;
```

åˆ é™¤ `login error` ç›¸å…³ã€‚

```tsx
{status === 'error' && loginType === 'account' && (
    <LoginMessage
        content={intl.formatMessage({
            id: 'pages.login.accountLogin.errorMessage',
            defaultMessage: 'Incorrect username/password!',
        })}
        />
)}
```

åˆ é™¤ç”¨ä¸åˆ°çš„ `import`ã€‚ï¼ˆctrl + alt + o ä¸€é”®åˆ é™¤æ‰€æœ‰ç”¨ä¸åˆ°çš„ `impoert`ï¼‰



#### æ·»åŠ é¡µé¢è·³è½¬ 

##### Error - æ²¡æœ‰å¯ç”¨çš„ `buttom` é¢„è®¾

ç”±äºæ•´ä¸ªç™»å½•çš„è¡¨å•éƒ½æ˜¯é¢„è®¾å¥½çš„ï¼Œæ¯”è¾ƒéš¾å»å•ç‹¬å¤åˆ¶ä¸€ä¸ªç™»å½•`buttom` ç”¨äºè·³è½¬æ³¨å†Œã€‚

è§£å†³ï¼šä½¿ç”¨ ant design çš„ `<Space>` é—´è·åˆ†éš”ç¬¦ã€‚

[é—´è· Space - Ant Design](https://ant.design/components/space-cn#components-space-demo-split)

[Space - Ant Design](https://ant.design/components/space#components-space-demo-split)

**æ³¨å†Œ -> ç™»å½•**

å»åˆ° `Login/index.tsx`ã€‚åœ¨`</LoginForm>` æœ€åéƒ¨åˆ†ï¼Œåœ¨ `<div> </div>` ä¹‹é—´æ·»åŠ ï¼š

`<Space ...>` å’Œ `<Link ...>`

```tsx
<div
    style={{
        marginBottom: 24,
    }}
>
    <Space size={[1, 1]} wrap split={<Divider type="vertical" />}>
        <ProFormCheckbox noStyle name="autoLogin">
            <FormattedMessage ..."Remember me" />
        </ProFormCheckbox>

        <Link to={"/user/register"}>Sign up </Link>

        <a
            style={{
                float: 'right',
            }}
            href={LinkedIn_contact}
            target="_blank"
            rel="noreferrer"
            >
            <FormattedMessage ..."Forgot password?" />
        </a>
    </Space>
</div>
```

```tsx
<Space size={[1, 1]}...
// explain: 
<Space size={[0~1 column width add on, not-important]}...
```





**æ·»åŠ æ³¨å†Œ->ç™»å½•é¡µé¢çš„è·³è½¬** 

å»åˆ° `Register/index.tsx`ã€‚åœ¨`</LoginForm>` ä¸Šé¢æ·»åŠ ï¼š

`<Space ...>` å’Œ `<Link ...>`

```tsx
...    
	<div
        style={{marginBottom: 24,}}
        >
        <Space size={[1, 1]} wrap split={<Divider type={"vertical"} />}>
            <Link to={"/user/login"}>Go to Login </Link>
        </Space>
    </div>
</LoginForm>
```





### æµ‹è¯•ç™»å½•åŠŸèƒ½

åœ¨åç«¯çš„ `UserController` é‡Œæ‰“ä¸Šæ–­ç‚¹ã€‚

```java
// define the Three argument we are receiving
String userAccount = userRegisterRequest.getUserAccount();
String userPassword = userRegisterRequest.getUserPassword();
String confirmPassword = userRegisterRequest.getConfirmPassword();
```

å»åˆ°å‰ç«¯ `src.app.tsx`ï¼ŒæŠŠ `timeout` è°ƒå¤§ã€‚å¦‚ï¼š10,000,000ï¼ŒåŸ10,000ã€‚

å°è¯•æ³¨å†Œè´¦å·ã€‚

1. `accountRuby`ï¼Œå¯†ç  `123456789`ã€‚

2. `accountBeta`ï¼Œå¯†ç  `123456789`ã€‚

å°è¯•ä¸¤ä¸ªå¯†ç ä¸ä¸€è‡´ã€‚

å°è¯•æ­£ç¡®æ³¨å†Œã€‚

F8 ä¸‹ä¸€æ­¥ã€‚F9 å®Œæˆæ‰€æœ‰ã€‚

æ³¨å†ŒæˆåŠŸï¼Œ<u>å¼¹å‡ºç™»å½•æˆåŠŸæç¤ºæ¡†ï¼Œ</u>è¿”å›åˆ° `user/login`ï¼Œå¹¶è¿”å›ç”¨æˆ·idï¼š

![image-20230620153814774](C:\Users\liyua\AppData\Roaming\Typora\typora-user-images\image-20230620153814774.png)

å°è¯•æ³¨å†Œä¸€ä¸ªå·²æœ‰çš„ç”¨æˆ·åã€‚ï¼ˆ`response` ä¼šæ˜¯ -1ï¼‰

å»åˆ°å‰ç«¯ `src.app.tsx`ï¼ŒæŠŠ `timeout` è°ƒå›10000ã€‚

#### Error - è¿”å›åœ°å€ `redirect=undefined`

ä½†è¿”å›çš„æ˜¯ `/user/login?redirect=undefined`ã€‚**redirect=undefined**ã€‚

è¡¨ç¤ºç”¨æˆ·å¹¶æ²¡ç”¨ `redirect` çš„å‚æ•°ã€‚

è§£å†³ï¼š

ctrl + b è¿›å…¥ `history.push` çš„ `push`ã€‚ç„¶åè¿›å…¥ `push(location: LocationDescriptorObject...` çš„ `LocationDescriptorObject`ã€‚å¾—çŸ¥æˆ‘ä»¬å¯ä»¥ç”¨è‡ªå¸¦çš„æ–¹æ³•ä¼ å…¥ `redirect` çš„åœ°å€å‚æ•°ã€‚

åˆ é™¤ `const { redirect }`ã€‚

æ·»åŠ  `history.push({...});` ä¼ å‚ã€‚

```tsx
if (!history) return;
const { query } = history.location;
history.push({
    pathname: '/user/login',
    query,
});
```







